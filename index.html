<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <meta property="og:site_name" content="PINKY  ManGON">

  <meta property="og:image:width" content="600">
  <meta property="og:image:height" content="315">
  <meta property="og:image" content="images/ogimage.png">
  <meta property="og:title" content="PINKY  ManGON 生日應援">
  <meta property="og:url" content="https://pinkymangon.github.io/807/">
  <meta property="og:description" content="歡迎大家一起來呷冰，看PINKY ManGon 一同慶祝곤듀誕生日，現場還有隱藏版遊戲可以玩唷！">
  <title>Pinky ManGon</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link href="http://openfontlibrary.org/face/segoe-ui-symbol" rel="stylesheet" type="text/css"/>
  <!-- Bootstrap Icons-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <!-- Google fonts-->
  <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic"
    rel="stylesheet" type="text/css" />
  <!-- SimpleLightbox plugin CSS-->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css" rel="stylesheet" />
  <!-- Core theme CSS (includes Bootstrap)-->
  <link rel="stylesheet" href="css/style.css" />
  <style>
    /* 這要給nav放背景圖用的
    background-image: url(images/title.jpg);
    background-repeat: no-repeat;
    background-position: center center;
    background-size: cover;
    color: #fff;
    padding: 0 20px;
    box-sizing: border-box;
    */
    .page-section h2 {
      font-weight: bold;
    }

    .info-section {
      margin-bottom: 20px;
    }

    .title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .subtitle {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 5px;
      position: relative;
    }

    .subtitle.text {
      margin-bottom: 10px;
      text-align: left;
      /* 內容左對齊 */
    }

    .important {
      color: var(--bs-primary);
    }


    #map {
      display: flex;
      justify-content: center;
      /* 水平置中 */
      align-items: center;
      /* 垂直置中 */
    }

    #map iframe {
      border-radius: 10px;
      /* 讓地圖顯示有圓角效果 */
      width: 100%;
      /* 設置地圖寬度為100% */
      max-width: 100%;
      /* 確保地圖不會超出容器 */
      height: 450px;
      /* 設置固定高度 */
    }

    .invalid-feedback {
      display: none;
    }

    .was-validated .form-control:invalid~.invalid-feedback,
    .was-validated .form-select:invalid~.invalid-feedback {
      display: block;
    }

    #map .container {
      max-width: 1200px;
      /* 設置容器的最大寬度 */
      margin: 0 auto;
      /* 使容器水平居中 */
    }

    @media (max-width: 768px) {
      #map iframe {
        height: 300px;
        /* 在小屏幕上設置地圖的高度 */
      }
    }

    .loading-icon {
      display: none;
      margin-left: 5px;
    }

    .btn.loading .loading-icon {
      display: inline-block;
    }

    .btn.loading .btn-text {
      display: none;
    }

    /*-驗證樣式修改-*/
    .was-validated .form-control:valid,
    .form-control.is-valid,
    .was-validated .form-select:valid,
    .form-select.is-valid {

      border: 1px solid #ced4da !important;
    }

    .was-validated .form-control:valid,
    .form-control.is-valid,
    .was-validated .form-select:valid:not([multiple]):not([size]),
    .was-validated .form-select:valid:not([multiple])[size="1"],
    .form-select.is-valid:not([multiple]):not([size]),
    .form-select.is-valid:not([multiple])[size="1"] {
      background-image: none !important;
    }

    .was-validated .form-control:invalid,
    .form-control.is-invalid {
      box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
    }

    .form-check-input:checked {
      background-color: var(--bs-primary) !important;
      border-color: var(--bs-primary) !important;
    }

    .invalid-feedback {
      display: none;
      width: 100%;
      margin-top: 0.25rem;
      font-size: 0.875em;
      color: #f84567;
      font-weight: bold;
    }

    .modal-img {
      border-radius: 50px;
      width: 280px;
      height: auto;
      text-align: center;
      margin: 1rem auto;
      display: block;
    }
  </style>
</head>

<body id="page-top">
  <!-- Navigation-->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">
    <div class="container px-4 px-lg-5">
      <a class="navbar-brand" href="#" onclick="reloadPage()">Pinky ManGon</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse"
        data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ms-auto my-2 my-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="#about">活動說明</a>
          </li>
          <!--
          <li class="nav-item">
            <a class="nav-link" href="#portfolio">GON</a>
          </li>
          -->
          <li class="nav-item">
            <a class="nav-link" href="#apply">預約登記</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="#contact">聯絡資訊</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="#map">店家資訊</a>
          </li>

        </ul>
      </div>
    </div>
  </nav>
  <!-- Masthead-->
  <header class="masthead">
    <div class="container px-4 px-lg-5 h-100">
      <div class="row gx-4 gx-lg-5 h-100 align-items-center justify-content-center text-center">
        <div class="col-lg-8 align-self-end">
          <h1 class="text-white font-weight-bold">
            Pinky ManGon
          </h1>
          <hr class="divider" />
        </div>
        <div class="col-lg-8 align-self-baseline">
          <p class="text-white-75 mb-5" >
            <span style="font-family: SegoeUISymbolRegular">
            &#x1FA77; + &#x26A1;&#xFE0F; + &#x1F96D; = &#x1F996;&#x1F496;
          </span>
          </p>
          <a class="btn btn-dark btn-xl" href="#about">前往活動說明</a>
        </div>
      </div>
    </div>
  </header>
  <!-- About-->
  <section class="page-section " id="about">
    <div class="container px-4 px-lg-5">
      <div class="row gx-4 gx-lg-5 justify-content-center">
        <div class="col-lg-8 text-center">
          <h2 class="text-primary mt-0">
            活動說明
          </h2>
          <hr class="divider " />
          <div class="mb-4">
            <div class="info-section text-primary">
              <div class="subtitle">💖哇嘎哩GON — We're EEEEE TEAM！</div>
              <div class="text">由於場地大小的關係，再加上我們採用非包場模式，所以店家會開放部分給一般民眾入內。為了控制店內人數，我們決定採用預約表單的方式來進行活動！</div>
            </div>
            <div class="info-section">
              <div class="subtitle">💛預約事項 ૮꒰˶ฅ́˘ฅ̀˶꒱ა</div>
              <div class="text">每一批次人數有限，活動時間為2小時</div>
              <div class="text">如果該時段的預約已滿，請另改其他時間進行預約</div>
              <div class="text">預約是否成功以信箱收到的信件為主</div>
              <div class="text">預約失敗請另改時間進行活動預約</div>
            </div>
            <div class="info-section">
              <div class="subtitle">🤍活動參與規則</div>
              <div class="text">為了讓皮皮們都能參與到活動，一天請勿預約超過一個梯次，但歡迎預約不同日來一起參與活動ᯓᡣ𐭩.ᐟ ⊹</div>
              <div class="text">臨時決定來參與的皮皮也可以在現場排隊，前一批的人離開或有多餘空位的時候，才會開放給現場排隊的皮皮入內ㄛ！</div>
            </div>
            <div class="info-section">
              <div class="subtitle">❤️應援禮發放 ପ꒰⑅•ᴗ•｡꒱໊♡</div>
              <div class="text">以使用表單線上預約成功的皮皮為主，有多餘的應援才會開放給現場排隊的皮皮領取，數量有限，發完為止！</div>
            </div>
            <div class="info-section">
              <div class="subtitle">💙店家資訊 ⊹₊ ⋆</div>
              <div class="text">地點：旁邊納涼 日式刨冰 Kakigori<br>106 台北市大安區延吉街131巷1弄20號</div>
              <div class="text">營業時間：12:00 - 20:00<br><span class="important">(休勾問題：禮拜二是12:00開始嗎還是14:00)</span></div>
            </div>
            <div class="info-section">
              <div class="subtitle">💜活動梯次時間 ꒰ᐢ. .ᐢ꒱₊˚⊹</div>
              <div class="text">活動日期：8/6 - 8/11</div>
              <div class="text">第一梯次 12:00 - 14:00</div>
              <div class="text">第二梯次 14:00 - 16:00</div>
              <div class="text">第三梯次 16:00 - 18:00</div>
              <div class="text">第四梯次 18:00 - 20:00</div>
              <div class="text">(每日皆有四個梯次，如果該梯次預約人數額滿，將不會顯示在表單內)</div>
            </div>
            <div class="info-section">
              <div class="subtitle">🧡表單統計時間</div>
              <div class="text">7/12 - 8/2止</div>
            </div>
            <div class="info-section">
              <div class="subtitle">💕注意事項</div>
              <div class="text">由於活動是採預約制，如果有晚到或臨時無法到場的情形，請事先告知主辦進行取消預約。</div>
              <div class="text">開放入場前如未到場，主辦會先聯絡表單內留下的聯絡資訊進行通知，如未到場也未回覆的人，將自動取消預約並開放名額給現場排隊的皮皮，請不要造成店家及主辦的困擾！！</div>
            </div>

          </div>

          <a class="btn btn-primary btn-xl" href="#apply">前往預約登記</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Portfolio-->
  <div id="portfolio">
    <div class="container-fluid p-0">
      <div class="row g-0">
        <div class="col-lg-4 col-sm-6">
          <a class="portfolio-box" href="images/gon1.jpg" title="哈利奎剛">
            <img class="img-fluid" src="images/gon1.jpg" alt="..." />
            <div class="portfolio-box-caption">
              <div class="project-category text-white-50">
                GON
              </div>
              <div class="project-name">哈利奎GON</div>
            </div>
          </a>
        </div>
        <div class="col-lg-4 col-sm-6">
          <a class="portfolio-box" href="images/gon2.jpg" title="偷偷跟你說">
            <img class="img-fluid" src="images/gon2.jpg" alt="..." />
            <div class="portfolio-box-caption">
              <div class="project-category text-white-50">
                GON
              </div>
              <div class="project-name">偷偷GON你說</div>
            </div>
          </a>
        </div>
        <div class="col-lg-4 col-sm-6">
          <a class="portfolio-box" href="images/gon3.jpg" title="最愛VVS">
            <img class="img-fluid" src="images/gon3.jpg" alt="..." />
            <div class="portfolio-box-caption">
              <div class="project-category text-white-50">
                GON
              </div>
              <div class="project-name">最愛VVS</div>
            </div>
          </a>
        </div>
        <div class="col-lg-4 col-sm-6">
          <a class="portfolio-box" href="images/gon4.jpg" title="阿~~~救救我">
            <img class="img-fluid" src="images/gon4.jpg" alt="..." />
            <div class="portfolio-box-caption">
              <div class="project-category text-white-50">
                GON
              </div>
              <div class="project-name">阿~~~救救我</div>
            </div>
          </a>
        </div>
        <div class="col-lg-4 col-sm-6">
          <a class="portfolio-box" href="images/gon5.jpg" title="我死了...">
            <img class="img-fluid" src="images/gon5.jpg" alt="..." />
            <div class="portfolio-box-caption">
              <div class="project-category text-white-50">
                GON
              </div>
              <div class="project-name">我死了...</div>
            </div>
          </a>
        </div>
        <div class="col-lg-4 col-sm-6">
          <a class="portfolio-box" href="images/gon6.jpg" title="我跳~">
            <img class="img-fluid" src="images/gon6.jpg" alt="..." />
            <div class="portfolio-box-caption p-3">
              <div class="project-category text-white-50">
                GON
              </div>
              <div class="project-name">我跳~</div>
            </div>
          </a>
        </div>
      </div>
    </div>
  </div>
  <!-- Call to action-->
  <!--
  <section class="page-section bg-dark text-white">
    <div class="container px-4 px-lg-5 text-center">
      <h2 class="mb-4">Free Download at Start Bootstrap!</h2>
      <a class="btn btn-light btn-xl" href="https://startbootstrap.com/theme/creative/">Download Now!</a>
    </div>
  </section>
  -->

  </section>
  <!-- apply-->
  <section class="page-section" id="apply">
    <div class="container px-4 px-lg-5">
      <div class="row gx-4 gx-lg-5 justify-content-center">
        <div class="col-lg-8 col-xl-6 text-center">
          <h2 class="mt-0 text-primary">一起來慶祝 곤듀 的生日吧 !</h2>
          <hr class="divider" />
          <p class="text-muted mb-5">
            準備好來呷冰玩遊戲嗎? <br>快來預約登記唷!
          </p>
        </div>
      </div>
      <div class="row gx-4 gx-lg-5 justify-content-center mb-5">
        <div class="col-lg-6">
          <form id="applyForm" method="post" action="#" class="needs-validation" novalidate>
            <!-- Email address input-->
            <div class="form-floating mb-3">
              <input class="form-control" id="email" name="email" type="email" required />
              <label for="email">電子郵件</label>
              <div class="invalid-feedback">*請輸入有效的電子郵件地址</div>
            </div>
            <!-- 選擇場次 input-->
            <div class="form-floating mb-3">
              <select id="round" name="round" class="form-control form-select" required>
                <!-- 其他選項將由JavaScript動態添加 -->
              </select>
              <label for="round">選擇參加的場次</label>
              <div class="invalid-feedback">*請選擇場次。</div>
            </div>
            <!-- 預約人數 input-->
            <p style="font-size: 12px;color:var(--bs-primary);">*注意選擇場次剩餘人數 (若填寫超過人數會預約失敗唷！)</p>
            <div class="form-floating mb-3">
              <input class="form-control" id="count" name="count" type="number" required />
              <label for="count">預約的人數</label>
              <div class="invalid-feedback">*請輸入預約人數。</div>
              <div class="invalid-feedback">*預約人數不能超過剩餘名額唷</div>
            </div>
            <!-- mangon_count input-->
            <div class="form-floating mb-3">
              <input class="form-control" id="mangon_count" name="mangon_count" type="number" required />
              <label for="mangon_count">ManGon 生日套餐份數</label>
              <div class="invalid-feedback">*請輸入份數,若沒有請填0。</div>
            </div>
            <!-- pinky_count input-->
            <div class="form-floating mb-3">
              <input class="form-control" id="pinky_count" name="pinky_count" type="number" required />
              <label for="pinky_count">PinkyGon 生日套餐份數</label>
              <div class="invalid-feedback">*請輸入份數,若沒有請填0。</div>
            </div>
            <!-- Name input-->
            <div class="form-floating mb-3">
              <input class="form-control" id="name" name="name" type="text" required />
              <label for="name">暱稱</label>
              <div class="invalid-feedback">*請輸入暱稱</div>
            </div>
            <!-- SNS input-->
            <div class="form-floating mb-3">
              <input class="form-control" id="sns" name="sns" type="text" required />
              <label for="sns">社群 ( IG / LINE社群名稱 )</label>
              <div class="invalid-feedback">*社群聯絡方式</div>
            </div>
            <!-- Phone number input-->
            <div class="form-floating mb-3">
              <input class="form-control" id="phone" name="phone" type="tel" required />
              <label for="phone">手機號碼</label>
              <div class="invalid-feedback">*請輸入手機號碼</div>
            </div>
            <!-- Message input-->
            <p style="font-size: 12px;color: var(--bs-primary);">*若預約人數超過兩人以上麻煩填寫第二人的聯絡方式 ( IG或社群名稱 )</p>
            <div class="form-floating mb-3">
              <textarea class="form-control" id="message" name="message" style="height: 10rem"></textarea>
              <label for="message">備註</label>
            </div>

            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="checkok" name="checkok" value="on" required>
              <label class="form-check-label" for="checkok"
                style="font-size: 14px;color: var(--bs-primary); font-weight: bold;">
                我已確認上述填寫內容，準備好要一起參與活動惹
              </label>
              <div class="invalid-feedback">
                *確認上述填寫無誤並勾選
              </div>
            </div>

            <!-- Submit success message-->
            <div class="d-none" id="submitSuccessMessage">
              <div class="text-center mb-3">
                <div class="fw-bolder">Gon Xi 您預約登記成功啦~</div>
                將會寄送通知信給您~ 再麻煩留意一下信件唷~
              </div>
            </div>
            <!-- Submit Button-->
            <div class="d-grid">
              <button class="btn btn-primary btn-xl" id="submitButton" type="submit">確認登記</button>
            </div>
          </form>

        </div>
      </div>
    </div>
  </section>
  <!-- contact-->
  <section class="page-section " id="contact">
    <div class="container px-4 px-lg-5">
      <div class="row gx-4 gx-lg-5 justify-content-center">
        <div class="col-lg-8 col-xl-6 text-center">
          <h2 class="mt-0 text-primary">聯絡資訊</h2>
          <hr class="divider" />
          <p class="text-muted mb-5">
            如有對生咖的相關問題都能哀居私訊OOO，我們將儘快為您解答！<br><span class="important">(休勾問題：需要說現場有互動遊戲嗎)</span>
          </p>
        </div>
      </div>
    </div>
  </section>
  <!-- MAP-->
  <section class="page-section bg-light text-muted" id="map">
    <div class="container px-4 px-lg-5">
      <div class="row gx-4 gx-lg-5 justify-content-center">
        <div class="col-lg-8 text-center">
          <h2 class="text-primary mt-0">
            店家資訊 ⊹₊ ⋆
          </h2>
          <hr class="divider divider-light" />
          <div class="text-white-75 mb-4">
            <div class="info-section text-muted">
              <div class="text">地點：旁邊納涼 日式刨冰 Kakigori<br>106 台北市大安區延吉街131巷1弄20號</div>
              <div class="text">營業時間：12:00 - 20:00<br><span class="important">(休勾問題：禮拜二是12:00開始嗎還是14:00)</span></div>
            </div>

          </div>
        </div>
      </div>
      <div id="map">
        <iframe
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3614.7308044804504!2d121.55189897537683!3d25.043208077810466!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3442abc69f4addb1%3A0x24cfd43b82733ebc!2zMTA25Y-w5YyX5biC5aSn5a6J5Y2A5bu25ZCJ6KGXMTMx5be3MeW8hDIw6Jmf!5e0!3m2!1szh-TW!2stw!4v1720164343880!5m2!1szh-TW!2stw"
          width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
    </div>
  </section>

  <!-- MSGModal -->
  <div class="modal fade" id="msgModal" tabindex="-1" role="dialog" aria-labelledby="msgModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-body">
          <img id="msgPic" src="images/loading.gif" class="modal-img" />
          <strong id="msg-text">
          </strong>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary cancel" data-dismiss="modal">取消</button>
          <button type="button" class="btn btn-primary ok">確認</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Footer-->
  <footer class="bg-dark py-5">
    <div class="container px-4 px-lg-5">
      <div class="small text-center text-white">
        Copyright &copy; 807 - EEEEE TEAM | IN TAIWAN |
      </div>
    </div>
  </footer>
  <!-- Bootstrap core JS-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!-- SimpleLightbox plugin JS-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.js"></script>

  <!-- 引入 validate.js 库 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/validate.js/0.13.1/validate.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.min.js"></script>

  <script>
    const PROXY_URL = 'https://script.google.com/macros/s/AKfycbzJbyo7Rvz3b9AItkD-_37JwX7hcx9QYSrdVNX1bdfRABdHfwDiMVI3eoOBy_J5x_3htg/exec';

    window.addEventListener("DOMContentLoaded", (event) => {
      // Navbar shrink function
      const navbarShrink = function () {
        const navbarCollapsible = document.body.querySelector("#mainNav");
        if (!navbarCollapsible) {
          return;
        }
        if (window.scrollY === 0) {
          navbarCollapsible.classList.remove("navbar-shrink");
        } else {
          navbarCollapsible.classList.add("navbar-shrink");
        }
      };

      // Shrink the navbar
      navbarShrink();

      // Shrink the navbar when page is scrolled
      document.addEventListener("scroll", navbarShrink);

      // Activate Bootstrap scrollspy on the main nav element
      const mainNav = document.body.querySelector("#mainNav");
      if (mainNav) {
        new bootstrap.ScrollSpy(document.body, {
          target: "#mainNav",
          rootMargin: "0px 0px -40%",
        });
      }

      // Collapse responsive navbar when toggler is visible
      const navbarToggler = document.body.querySelector(".navbar-toggler");
      const responsiveNavItems = [].slice.call(
        document.querySelectorAll("#navbarResponsive .nav-link")
      );
      responsiveNavItems.map(function (responsiveNavItem) {
        responsiveNavItem.addEventListener("click", () => {
          if (window.getComputedStyle(navbarToggler).display !== "none") {
            navbarToggler.click();
          }
        });
      });

      // Activate SimpleLightbox plugin for portfolio items
      new SimpleLightbox({
        elements: "#portfolio a.portfolio-box",
      });




    });


    async function fetchRounds() {
      try {
        const response = await fetch(PROXY_URL + '?action=getRounds');
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        // 檢查返回的內容是否是 JSON
        const contentType = response.headers.get('Content-Type');
        if (!contentType || !contentType.includes('application/json')) {
          // 打印響應的內容，以幫助調試
          const textResponse = await response.text();
          console.error('Expected JSON, but got:', textResponse);
          throw new Error('Expected JSON, but got something else');
        }

        // 解析 JSON
        const rounds = await response.json();
        const roundSelect = document.getElementById('round');
        // 清空之前的選項
        roundSelect.innerHTML = '';

        // 將獲取到的數據添加到選單中
        rounds.forEach((round, index) => {
          const option = document.createElement('option');
          option.value = round.round;
          option.text = round.round;
          option.setAttribute('data-max', round.max);
          roundSelect.appendChild(option);
          // 設置 count 的最大值為第一個選項的 data-max
          if (roundSelect.options.length > 0) {
            const firstOption = roundSelect.options[0];
            const max = firstOption.getAttribute('data-max');
            const countInput = document.getElementById('count');
            countInput.max = max;
          }

        });
        $('#round').prop('selectedIndex', 0).trigger('change');
        $('#count').attr('max', $('#round option:selected').data('max'));

      } catch (error) {
        console.error('Error fetching rounds:', error);
      }
    }

    document.addEventListener('DOMContentLoaded', fetchRounds);

    // 監聽下拉選單的 change 事件
    document.getElementById('round').addEventListener('change', function () {
      const selectedOption = this.options[this.selectedIndex];
      const max = selectedOption.getAttribute('data-max');
      const countInput = document.getElementById('count');

      countInput.value = ''; // 清空輸入框
      countInput.max = max; // 設置最大值
    });
    /*
   // 控制 count input 超過最大值時顯示錯誤消息
   document.getElementById('count').addEventListener('input', function () {
     const countInput = this;
     const max = countInput.max;
     if (countInput.value > max) {
       countInput.setCustomValidity(`*預約人數不能超過最大值 ${max}`);
     } else {
       countInput.setCustomValidity('');
     }
     countInput.reportValidity(); // 顯示驗證錯誤消息
   });

*/


    document.getElementById('count').addEventListener('input', function () {
      const count = parseInt(this.value, 10);
      if (count > 2) {
        document.querySelector('[name="message"]').setAttribute('required', 'required');
      } else {
        document.querySelector('[name="message"]').removeAttribute('required');
      }
    });

    document.getElementById("applyForm").addEventListener("submit", async function (event) {

      event.preventDefault(); // 阻止默認表單提交行為
      var form = this;

      form.classList.remove('was-validated');
      const formData = new FormData(form);
      const formObject = {};
      formData.forEach((value, key) => {
        formObject[key] = value;
      });

      const constraints = {
        email: {
          presence: true,
          email: true
        },
        round: {
          presence: true
        },
        count: {
          presence: true,
          numericality: {
            onlyInteger: true,
            greaterThan: 0,
            lessThanOrEqualTo: function () {
              const roundSelect = document.getElementById("round");
              const selectedOption = roundSelect.options[roundSelect.selectedIndex];
              return parseInt(selectedOption.getAttribute("data-max"), 10);
            }
          }
        },
        mangon_count: {
          presence: true,
          numericality: {
            onlyInteger: true,
            greaterThanOrEqualTo: 0
          }
        },
        pinky_count: {
          presence: true,
          numericality: {
            onlyInteger: true,
            greaterThanOrEqualTo: 0
          }
        },
        name: {
          presence: true
        },
        sns: {
          presence: true
        },
        phone: {
          presence: true,
          length: {
            is: 10 // 调整为适合你的电话号码格式
          }
        },
        message: {
          presence: false,
          if: function (value, attributes) {
            return attributes.count > 2;  // 當 count 大於 2 時，message 變為必填
          }
        },
        mangon_and_pinky_count: {
          customValidation: function (value, attributes) {
            const mangonCount = parseInt(attributes.mangon_count, 10);
            const pinkyCount = parseInt(attributes.pinky_count, 10);
            const count = parseInt(attributes.count, 10);
            if (mangonCount + pinkyCount < count) {
              return "由於店家的低消限制，ManGon 和 PinkyGon 的總份數必須大於或等於預約人數。";
            }
          }
        }
      };

      const validate = require('validate.js');
      validate.validators.customValidation = function (value, options, key, attributes) {
        if (typeof options === 'function') {
          return options(value, attributes);
        }
        return options.customValidation ? options.customValidation(value, attributes) : null;
      };

      const errors = validate(formObject, constraints);

      if (errors) {
        for (const [field, fieldErrors] of Object.entries(errors)) {
          const input = form.querySelector(`[name=${field}]`);
          if (input) {
            input.classList.add('is-invalid');
            const feedback = input.nextElementSibling;
            if (feedback) {
              feedback.textContent = fieldErrors[0];
            }
          }
        }
        form.classList.add('was-validated');
        return;
      }
      if (confirm('確認要送出?')) {

        setMsgModalShow("loading");

        var $submitButton = $('#submitButton');
        $submitButton.prop('disabled', true);
        $('#msgModal').modal('show');
        // 進行驗證
        /*const formData = new FormData(form);
        const formObject = {};
        formData.forEach((value, key) => {
          formObject[key] = value;
        });
*/
        // 將表單數據轉換為 JSON
        const jsonData = JSON.stringify(formObject);

        try {
          // POST 
          const response = await fetch(PROXY_URL, {
            mode: 'cors',
            method: 'POST',
            headers: {
              'Content-Type': 'text/plain;charset=utf-8',
            },
            body: jsonData,
          });

          // 處理響應
          const resData = await response.json();
          console.log(resData);  // 打印結果到控制臺
          if (resData.result == 'ok') {
            let $success = $('#submitSuccessMessage');
            $success.removeClass("d-none");
            //lock
            Array.from(this.elements).forEach(element => element.disabled = true);
            document.getElementById('submitButton').remove();
            // 更新下拉選項
            fetchRounds();
          }
          else {
            alert(resData.message);
            if (resData.status == '09') {
              // 超額更新下拉選項
              fetchRounds();
            }
            $submitButton.removeClass('loading');
            $submitButton.prop('disabled', false);
          }

        } catch (error) {
          console.log('Error submitting the form:', error);
          alert("提交表單時發生錯誤");
          $submitButton.removeClass('loading');
          $submitButton.prop('disabled', false);
          $('#msgModal').hide();
        }

      }
      else {
        $submitButton.removeClass('loading');
        $submitButton.prop('disabled', false);
        return;
      }

    });

    function setMsgModalShow(type, msg) {

      const picName = "";

      switch (type) {
        case "success":
          picName = "gonxi.gif";

          break;
        case "error":
          picName = "wow.gif";
          break;
        case "loading":

          picName = "loading.gif";
          msg = "表單送出中...<br>請勿離開頁面，請耐心等候！";

          break;
      }
      document.getElementById('msgPic').src = "images/" + picName;
      $('#msgModal #msg-text').html(msg);
      $('#msgModal').modal('show');
    }

    function reloadPage() {
      // 使用 location.replace 重新加载当前页面而不带 # 符号
      window.location.replace(window.location.href.split('#')[0]);
    }

  </script>
</body>

</html>
